

<!DOCTYPE html>
<html lang="en">

<head>
    <title>IOI 2022 Towers 题解 - KarL05&#39;s Blog</title>
<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Tony Wu">
<meta name="description" content="IOI 2022 D1T3 Towers 题解
题目链...">
<meta name="keywords" content="Blog">

<link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml">

    <meta charset="utf-8">
    <meta name="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="telephone=no" name="format-detection">
    <meta name="renderer" content="webkit">
    <meta name="theme-color" content="#ffffff">
    


<!-- modify begin -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<meta name="referrer" content="no-referrer"> 
<!-- modify end -->

<link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="/css/journal.css?74289619">


<link rel="stylesheet" href="https://lib.baomitu.com/highlight.js/11.2.0/styles/github.min.css" crossorigin="anonymous">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora|Montserrat|Anonymous+Pro:400|Material+Icons">

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
<div id="top"></div>

<div id="app">
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            <a class="a-block drawer-menu-item false" href="https://7ue9ueue.github.io">
                Home
            </a>

            
                
                    <a class="a-block drawer-menu-item false"
                       href="/archives">
                        Archive
                    </a>
                
                    <a class="a-block drawer-menu-item false"
                       href="/Trending.html">
                        Trending
                    </a>
                
                    <a class="a-block drawer-menu-item false"
                       href="/tags">
                        Tags
                    </a>
                
                    <a class="a-block drawer-menu-item false"
                       href="/categories">
                        Category
                    </a>
                
                    <a class="a-block drawer-menu-item false"
                       href="/Links.html">
                        Friends
                    </a>
                
                    <a class="a-block drawer-menu-item false"
                       href="/About.html">
                        About Me
                    </a>
                
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="/">
            KarL05&#39;s Blog
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="/">
        <div class="single-column-header-title">KarL05&#39;s Blog</div>
        <div class="single-column-header-subtitle"></div>
    </a>
</div>

<div ref="sideContainer" class="side-container">
    <a class="a-block nav-head false" href="/">
        <div class="nav-title">
            Blog
        </div>
        <div class="nav-subtitle">
            Tony Wu
        </div>
    </a>

    <div class="nav-link-list">
        
            
                <a class="a-block nav-link-item false"
                   href="/archives">
                    Archive
                </a>
            
                <a class="a-block nav-link-item false"
                   href="/Trending.html">
                    Trending
                </a>
            
                <a class="a-block nav-link-item false"
                   href="/tags">
                    Tags
                </a>
            
                <a class="a-block nav-link-item false"
                   href="/categories">
                    Category
                </a>
            
                <a class="a-block nav-link-item false"
                   href="/Links.html">
                    Friends
                </a>
            
                <a class="a-block nav-link-item false"
                   href="/About.html">
                    About Me
                </a>
            
        
    </div>

    
    <div class="nav-footer">
        Proudly published with Hexo<br>
        
        Theme <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> by <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a><br>
        
        &copy; 2023 <a href="https://7ue9ueue.github.io">KarL05&#39;s Blog</a>
    </div>
</div>

<div ref="extraContainer" class="extra-container">
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>

        
    </div>
</div>



<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper-text-only"
                 style="background-image: url('')">
                <div class="post-title">
                    IOI 2022 Towers 题解
                    <div class="post-meta">
                        <time datetime="2022-12-31T16:00:00.000Z" itemprop="datePublished">
                            2023-01-01 00:00
                        </time>&nbsp;
                        
                        
                        <i class="material-icons" style="">folder</i>
                        
                        <a href='/categories/题解Solution/'>题解Solution</a>
                        
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/中文Chinese/'>中文Chinese</a>, 
                        
                        <a href='/tags/归档Archived/'>归档Archived</a>, 
                        
                        <a href='/tags/信竞OI/'>信竞OI</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    
                    <h1 id="ioi-2022-d1t3-towers-题解">IOI 2022 D1T3 Towers 题解</h1>
<p>题目链接: https://ioi2022.id/tasks/</p>
<p>通过人数：8/357</p>
<p>题目难度：CF3000?</p>
<p>题目等价与选出一些点，使得这些点之间两两有边。</p>
<p>首先，观察到题目有笛卡尔树的形式。注意到笛卡尔树是二叉树。</p>
<h3 id="d-1">D = 1</h3>
<p>当 D
的限制不存在的时候，笛卡尔树上任何一个节点的的左子树的任何一个节点都可以前往右子树的另一个节点。这两个点之间一定有一条边。因此我们可以尝试令
f[i] 为 i 节点内的字数内的答案。并且动态规划。</p>
<p>考虑最小的树的情况，也就是一个节点和两个孩子：可以发现，两个孩子都可以选择。也就是
<code>f[i] = f[ls[i]]+f[rs[i]]</code>,
但是，当一个孩子都没有的时候，其实也可以选择这个节点本身。所以实际上动态规划的转移方程是
<code>f[i] = max(1,f[ls[i]]+f[rs[i]])</code>, 其中 <code>ls</code>
代表左子树的编号，<code>rs</code> 代表右子树的编号。</p>
<p>此时如果对于每个询问去做一次动态规划，就可以得到答案了。具体就是，找到这个区间对应的笛卡尔树上的一些节点，累加即可。</p>
<p>有没有更快的计算方式呢？有的。可以发现，<code>f[i] = max(1,f[ls[i]]+f[rs[i]])</code>
等价与
<code>f[i] 的叶子节点数量</code>。利用这个特征就可以快速计算了。</p>
<p>证明是显然的。分两类讨论：</p>
<p>如果一个节点没有孩子，他就是孩子，而
<code>f[i] = max(1,f[ls[i]]+f[rs[i]]) = 1</code>. 也就是孩子的数量。</p>
<p>如果一个节点有孩子，那么它左边子树和右边子树的每个答案必然也是孩子个数，数学归纳证明即可。</p>
<p>现在问题变成了：给一个区间 <code>[L,R]</code>, 这里面有多少个叶子？
线段树回答询问即可。</p>
<h3 id="d-1-但是-l-1-和-r-n">D &gt; 1 但是 L = 1 和 R = n</h3>
<p>如果 <code>D&gt;1</code>
动态规划的转移式是什么样的呢？更具体的问，<code>D&gt;1</code>
会产生什么变化？产生的变化是某些节点<strong>不再能令左边的全部节点和右边的全部节点可选</strong>，而是需要同时满足
<code>h[i]-h[other]&gt;=D</code>。</p>
<p>换句话来说，某个叶子由于高度问题，在笛卡尔树上比较深的地方，不能参与转移。在比较高的地方才可以。</p>
<p>那能不能把这个叶子 “移动”
祖先上第一个可以参与转移的节点呢？那么答案是不是就还是 "叶子节点的个数"
呢？答案是肯定的。DFS一遍找到转移的位置即可。</p>
<p>现在的叶子，就是只考虑参与 “移动”
后的位置的情况。如果它的子树内没有其他 “移动”
过来的节点，那么它就是叶子，</p>
<p>但是这个时候怎么计算区间 给一个区间 <code>[L,R]</code>,
这里面有多少个
"叶子"？这个是不好计算的，因为叶子的位置随时随地在变化。怎么记录叶子的变化的？可以考虑可持久化线段树。考虑倒序考虑所有的
D, 那么 "叶子" 的位置一定慢慢从根走到叶子。</p>
<p>但是直接维护的情况变化次数是叶子的深度的和，也就是 <span
class="math inline">\(O(n^2)\)</span>。减少的方式是令这个原本在线段树代表叶子的
<code>1</code> 换一个其他的位置，也就是给它的对应的祖先。</p>
<p>换句话来说，如果某一个时刻我们想把一个位置的 <code>1</code>
下方到它的两个孩子。我们需要做三次操作：一次 <code>-1</code> 和两次
<code>+1</code>. 但是如果我们保留这个当前位置的
<code>1</code>，也就是忽视一个孩子需要 <code>+1</code>
的操作而只考虑另外一个，我们只需要修改一次了。</p>
<p>也就是线段树的上 <code>1</code> 不再是说明这个位置是一个
"叶子"，而是这个位置的孩子有一个 "叶子"。</p>
<p>这样子就只需要修改 <span class="math inline">\(O(n)\)</span>
次了。怎么知道要修改的是左孩子还是右孩子呢？</p>
<p>如果考虑使得 <code>h[i]-h[other]&lt;D</code>的 <code>other</code>
点为消失，那么最后一个完全消失的节点是我们希望修改的，因为这个节点所代表的子树是关键的。如果另外一个子树消失，答案不会变化，如果这个子树消失，答案就会变化。这里的答案指
"移动" 后的位置对答案的影响。</p>
<p>也就是该子树内最小的节点比另一个大。这样，我们就找到了一个顺序，并且只需要修改可持久化线段树
<span class="math inline">\(O(n)\)</span> 次，对应线段树询问即可。</p>
<h3 id="full-solution">Full Solution</h3>
<p>注意到线段树上 “叶子”
节点的位置并不是真正的位置，也是在该位置时不会对答案有影响。</p>
<p>但是这是不可能的，当区间询问时，答案还是会受到影响。</p>
<p>如果一个节点不在 <code>[L,R]</code>
的区间内，但是它转移的节点在的话，就会被多算一次。因此，这种情况我们希望减掉。</p>
<p>怎么处理？这种情况现在只会在最左边和最右边发生一次。对于最边上的节点
<code>pos</code>，我们考虑它是不是被 <code>[L,pos-1] or [pos+1,R]</code>
内的点转移过来的即可。也就是 <code>[L,pos-1] or [pos+1,R]</code>
内的最小值需要大于 <code>h[pos]-D</code>.</p>
<p>题目得到解决 <span class="math inline">\(O(n\log n)\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">#include&quot;bits/stdc++.h&quot;</span><br><span class="line">#include&quot;iostream&quot;</span><br><span class="line">#include&quot;vector&quot;</span><br><span class="line">#include&quot;towers.h&quot;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">const int maxn = 1e5+5;</span><br><span class="line">int ls[maxn], rs[maxn], h[maxn], stk[maxn], fa[maxn];</span><br><span class="line">int leaf[maxn];</span><br><span class="line">int st[maxn][30], ln[maxn];</span><br><span class="line">int n,q,pter;</span><br><span class="line">int L[maxn*40], R[maxn*40], val[maxn*40], vis[maxn];</span><br><span class="line">int mn[maxn];</span><br><span class="line">int rt[maxn];</span><br><span class="line">pair&lt;int,int&gt; s[maxn];</span><br><span class="line">vector&lt;int&gt; e[maxn];</span><br><span class="line"></span><br><span class="line">int larger(int x) &#123;</span><br><span class="line">    int l = 1, r = n; </span><br><span class="line">    int ans = 0;</span><br><span class="line">    while (l&lt;=r) &#123;</span><br><span class="line">        int mid = (l+r)/2;</span><br><span class="line">        if (s[mid]&gt;=make_pair(x,-1)) &#123;</span><br><span class="line">            ans = mid;</span><br><span class="line">            r = mid-1;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            l = mid+1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void descartes () &#123;</span><br><span class="line">    int top = 0;</span><br><span class="line">    for (int i=1;i&lt;=n;i++) &#123;</span><br><span class="line">        int k = top;</span><br><span class="line">        while (k&gt;0 and h[stk[k]]&lt;h[i]) k--;</span><br><span class="line">        if (k) rs[stk[k]] = i; </span><br><span class="line">        if (k&lt;top) ls[i] = stk[k+1]; </span><br><span class="line">        stk[++k] = i;</span><br><span class="line">        top = k;</span><br><span class="line">    &#125;</span><br><span class="line">    for (int i=1;i&lt;=n;i++) &#123;</span><br><span class="line">        if (ls[i]) fa[ls[i]] = i;</span><br><span class="line">        if (rs[i]) fa[rs[i]] = i;</span><br><span class="line">        if (!ls[i] and !rs[i]) leaf[i] = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int stquery (int l, int r) &#123;</span><br><span class="line">	if (l&gt;r) return 1e9;</span><br><span class="line">    int logsize = ln[r-l+1];</span><br><span class="line">    int ans = min(st[l][logsize],st[r-(1&lt;&lt;logsize)+1][logsize]);</span><br><span class="line">    return ans;</span><br><span class="line">&#125;</span><br><span class="line">int findfirst (int p, int l, int r, int ql, int qr) &#123;</span><br><span class="line">    if (val[p]==0) return -1;</span><br><span class="line">    if (l==r) return (l+l+r+r)/4;</span><br><span class="line">    int mid = (l+r)&gt;&gt;1;</span><br><span class="line">    int ans = -1;</span><br><span class="line">    if (ql&lt;=l &amp;&amp; r&lt;=qr) &#123;</span><br><span class="line">        if (val[L[p]]&gt;0) return findfirst(L[p],l,mid,ql,qr);</span><br><span class="line">        else return findfirst(R[p],mid+1,r,ql,qr);</span><br><span class="line">    &#125;</span><br><span class="line">    if (ql&lt;=mid) ans = findfirst(L[p],l,mid,ql,qr);</span><br><span class="line">    if (ans==-1 &amp;&amp; qr&gt;mid) ans = findfirst(R[p],mid+1,r,ql,qr);</span><br><span class="line">    return ans;</span><br><span class="line">&#125;</span><br><span class="line">int findlast (int p, int l, int r, int ql, int qr) &#123;</span><br><span class="line">    if (val[p]==0) return -1;</span><br><span class="line">    if (l==r) return (l+l+r+r)/4;</span><br><span class="line">    int mid = (l+r)&gt;&gt;1;</span><br><span class="line">    int ans = -1;</span><br><span class="line">    if (ql&lt;=l &amp;&amp; r&lt;=qr) &#123;</span><br><span class="line">        if (val[R[p]]&gt;0) return findlast(R[p],mid+1,r,ql,qr);</span><br><span class="line">        else return findlast(L[p],l,mid,ql,qr);</span><br><span class="line">    &#125;</span><br><span class="line">    if (qr&gt;mid) ans = findlast(R[p],mid+1,r,ql,qr);</span><br><span class="line">    if (ans==-1 &amp;&amp; ql&lt;=mid) ans = findlast(L[p],l,mid,ql,qr);</span><br><span class="line">    return ans;</span><br><span class="line">&#125;</span><br><span class="line">void build (int &amp;p, int l, int r) &#123;</span><br><span class="line">    p = ++pter;</span><br><span class="line">    if (l==r) return;</span><br><span class="line">    int mid = (l+r)&gt;&gt;1;</span><br><span class="line">    build(L[p],l,mid);build(R[p],mid+1,r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void update (int &amp;p, int x, int l, int r) &#123;</span><br><span class="line">    int t = p;</span><br><span class="line">    p = ++pter;</span><br><span class="line">    L[p] = L[t]; </span><br><span class="line">    R[p] = R[t];</span><br><span class="line">    val[p] = val[t];</span><br><span class="line">    val[p]++;</span><br><span class="line">    if (l==r) return;</span><br><span class="line">    int mid = (l+r)&gt;&gt;1;</span><br><span class="line">    if (x&lt;=mid) update(L[p],x,l,mid);</span><br><span class="line">    else update(R[p],x,mid+1,r);</span><br><span class="line">    //cout&lt;&lt;L[p]&lt;&lt;&quot; &quot;&lt;&lt;R[p]&lt;&lt;&quot; &quot;&lt;&lt;p&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int query (int p, int l, int r, int ql, int qr) &#123;</span><br><span class="line">	if (ql&lt;=l &amp;&amp; r&lt;=qr) &#123;</span><br><span class="line">		return val[p];</span><br><span class="line">	&#125;</span><br><span class="line">	int mid = (l+r)&gt;&gt;1;</span><br><span class="line">	int ans = 0;</span><br><span class="line">	if (ql&lt;=mid) ans += query(L[p],l,mid,ql,qr);</span><br><span class="line">	if (qr&gt;mid) ans += query(R[p],mid+1,r,ql,qr);</span><br><span class="line">	return ans;</span><br><span class="line">&#125;</span><br><span class="line">void DFS (int x) &#123;</span><br><span class="line">	vis[x] = true;</span><br><span class="line">    if (ls[x] and !vis[ls[x]]) DFS(ls[x]);</span><br><span class="line">    if (rs[x] and !vis[rs[x]]) DFS(rs[x]);</span><br><span class="line">    if (!ls[x] and !rs[x]) return;</span><br><span class="line">	mn[x] = min(&#123;mn[x],mn[ls[x]],mn[rs[x]]&#125;);</span><br><span class="line">	s[x].first = h[x]-max(mn[ls[x]],mn[rs[x]]);</span><br><span class="line">	s[x].second = x;</span><br><span class="line">&#125;</span><br><span class="line">void init (int N, vector&lt;int&gt; H) &#123;</span><br><span class="line">    n = N;</span><br><span class="line">    h[0] = 2e9;mn[0] = 2e9;</span><br><span class="line">    for (int i=1;i&lt;=n;i++) &#123;</span><br><span class="line">        h[i] = H[i-1];</span><br><span class="line">        mn[i] = h[i];</span><br><span class="line">        st[i][0] = h[i];</span><br><span class="line">    &#125;</span><br><span class="line">    ln[1] = 0;ln[2] = 1;</span><br><span class="line">    for (int i=3;i&lt;maxn;i++) &#123;</span><br><span class="line">        ln[i] = ln[i&gt;&gt;1]+1;</span><br><span class="line">    &#125;</span><br><span class="line">    descartes();</span><br><span class="line">    for (int j=1;j&lt;=20;j++) &#123;</span><br><span class="line">        for (int i=1;i+(1&lt;&lt;j)-1&lt;=n;i++) &#123;</span><br><span class="line">            st[i][j] = min(st[i][j-1],st[i+(1&lt;&lt;(j-1))][j-1]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    build(rt[n+1],1,n);</span><br><span class="line">    for (int i=1;i&lt;=n;i++) &#123;</span><br><span class="line">        if (!vis[i]) DFS(i);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(s+1,s+n+1);</span><br><span class="line">	for (int i=1;i&lt;=n;i++) &#123;</span><br><span class="line">		if (s[i].first&gt;0) e[larger(s[i].first)].push_back(s[i].second);</span><br><span class="line">	&#125;</span><br><span class="line">    for (int i=n;i&gt;=1;i--) &#123;</span><br><span class="line">    	rt[i] = rt[i+1];</span><br><span class="line">    	for (int j=0;j&lt;e[i].size();j++) &#123;</span><br><span class="line">    		update(rt[i],e[i][j],1,n);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int max_towers(int l, int r, int d) &#123;</span><br><span class="line">    l++;r++;</span><br><span class="line">	int cnt = larger(d);</span><br><span class="line">	int ans = query(rt[cnt],1,n,l,r);</span><br><span class="line">	if (ans&gt;0) &#123;</span><br><span class="line">        int pos = findfirst(rt[cnt],1,n,l,r);</span><br><span class="line">		if (!leaf[pos] &amp;&amp; stquery(l,pos-1)+d&gt;h[pos]) ans--;</span><br><span class="line">    &#125;</span><br><span class="line">    if (ans&gt;0) &#123;</span><br><span class="line">        int pos = findlast(rt[cnt],1,n,l,r);</span><br><span class="line">		if (!leaf[pos] &amp;&amp; stquery(pos+1,r)+d&gt;h[pos]) ans--;</span><br><span class="line">    &#125;</span><br><span class="line">	return ans+1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                </div>
            </div>
    
            
<nav class="post-pagination">
    
    <a class="newer-posts" href="/2023/01/01/%E4%B8%AD%E6%96%87/IOI22%20Prison%20%E9%A2%98%E8%A7%A3/">
        Previous post<br>IOI 2022 Prisons 题解
    </a>
    
    <span class="page-number"></span>
    
    <a class="older-posts" href="/2023/01/01/%E4%B8%AD%E6%96%87/MCMF%20%E6%A8%A1%E6%9D%BF/">
        Next post<br>网络流 Dinic 学习笔记
    </a>
    
</nav>


    
            

<div class="post-comment-wrapper-giscus">
    <div class="giscus"></div>
</div>



        </div>
    </div>
    <div class="single-column-footer">
    Proudly published with Hexo<br>
    
    Theme <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> by <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a><br>
    
    &copy; 2023 <a href="https://7ue9ueue.github.io">KarL05&#39;s Blog</a>
</div>
</div>

</div>


<script src="https://lib.baomitu.com/jquery/3.3.1/jquery.min.js" crossorigin="anonymous"></script>
<script src="https://lib.baomitu.com/popper.js/1.14.4/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://lib.baomitu.com/twitter-bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="https://lib.baomitu.com/vue/2.5.17/vue.min.js" crossorigin="anonymous"></script>
<script src="https://lib.baomitu.com/smooth-scroll/14.2.1/smooth-scroll.min.js" crossorigin="anonymous"></script>
<script src="/js/journal.min.js?12313402"></script>




<script src="https://giscus.app/client.js"
        
        data-repo="7ue9ueue/7ue9ueue.github.io"
        
        data-repo-id="R_kgDOJqovWQ"
        
        data-category="Announcements"
        
        data-category-id="DIC_kwDOJqovWc4CXE4u"
        
        data-mapping="pathname"
        
        data-reactions-enabled="1"
        
        data-emit-metadata="0"
        
        data-theme="light_high_contrast"
        
        crossorigin="anonymous"
        async>
</script>



</body>
</html>
