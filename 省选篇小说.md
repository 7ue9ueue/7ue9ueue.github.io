# 省选番外 Chapter 1

今天是甘肃省省选的日子, 也就是省队选拔。

在省选中表现出色的选手, 可以代表省去参加NOI, 与全国各地的选手同台竞技。

但是今年甘肃的情况却有些特殊。

原不是信息强省的甘肃省, 却要和重庆市统一进行省队选拔。

其中重庆巴蜀中学和西南大学附属中学, 更是被神眷顾的学校。大名鼎鼎的金级魔法师们多数的出于这些学校。

那么这场考试的难度注定会远超预期。

luz 边走边想着, 四周繁华的街道长和闪烁的灯光无疑不宣示着重庆市的繁华。但却又不凌乱, 一位位身穿法袍的走在宽敞的石板路上, 挥动着手中的法杖。而她周围仿佛是有一面形状怪异的镜子, 光开始在她身边扭曲。

显然她是一名高阶物理魔法师。她似乎和 luz 走的方向一致, 都在前往重庆巴蜀中学。

luz 并不是很认识路, 于是她抓紧步伐, 快步的找到前面那位魔法师。

「姐姐好, 请问重庆巴蜀中学怎么走?」

她回过头来, 看向了 luz。

她的法袍和 luz 的截然不同。甚至可以说, luz 从未见过如此的独特的法袍。材质似乎是魔兽的皮革, 而不是朴素的布料。

似乎是物理学派的人。手上握住 luz 从未见过的法杖。他们制作着现代社会中最具有毁灭性的武器。她的手似乎在微微的抖动, 仿佛下一秒就是一个毁灭世界的魔法。

「前面再拐弯就到了」她说, 「你是要去参加省选?」, 也停止了手上的动作。

「嗯对, 我是甘肃省圣菲利普斯学校的学生。」

真是令人恐惧呢。luz 心想。她慢慢后退, 到了安全的距离后, 深吸了一口气, 说道

 「非常感谢!」

她顺势慢慢的离开, 但忽然被叫住了

「我们估计很快又会见面了呢, 甘肃的小朋友, 我....」

她开始入迷得做出了自我介绍, 可 luz 早就就跑远了。

「我反而希望永远不会, 危险的陌生人」luz 边走边想。

---

# 省选番外 Chapter 2

省选给这座城市带来了太多的影响。

随处可见手持法杖的魔法师, 也可以见到不了解魔法但是却在巴蜀周围附近跃跃欲试, 想尝试魔法的人们。

「我们有一对一魔法导师! 省一等奖选手亲自教学!」

「来体验体验数学魔法吧! 50银币一次!」

拿着简陋法杖的人挥舞着自己的法杖。那法杖就像皇冠一样, 令周围的人对他没有理由的信服。他铺子前的长队似乎已经有了几米长。无知的观众们, 苦苦凑齐银币, 只为体验这一次魔法。

他身着一件黑色的法袍, 这是魔法学徒的证明。胸前别着一个绿色的宝石, 相比之前那位物理魔法师, 这位水平显然差的多。

比起花费50银币去释放一次魔法, 吃一顿正宗的重庆火锅显然是一个好得多得多, luz 心想。

而且还能吃好多好多肉, 菜都能随便加。

抱着凑热闹的心态, luz 走到那位魔法师的铺子面前, 和其他人一样, 观察这位神奇的魔法师。

「下一位, 快点!」

「尊敬的魔法师大人啊, 我实在是凑不出50银币啊, 求您开开恩, 给我一次机会吧」

「那就滚开, 不要挡道!」

一个衣衫破旧的男人拿着他手上个位数的银币, 求着那位魔法师。

这不应该收取任何费用, 作为一名魔法师, 他理应让其他人也能了解自然魔法。

至少 luz 是这样认为的。尽管自己再认为他的行为不对, 也不能阻挡了别人做生意。

而且她现在要尽快前往巴蜀中学进行省选, 维护这些细枝末节的事情并不是很有必要的。

除了面前的这个魔法师, 也有无数的魔法师趁着省选日狠狠赚上一笔。

很多人仰慕魔法的存在。但魔法其实并没有那么的与众不同。大多数魔法学徒不过能做的不过是释放的魔术一样的小把戏似的魔法。

而且魔法并不是人人都有机会掌握的。

有的人一辈子无法接受魔法的存在。有的人无法找到学习的门径, 而自认为是自己的天赋的问题。

认为能释放魔法的人, 是被神眷顾的存在。

但因为自己不被眷顾, 而去放弃欣赏自然魔法的人们, 诸不知自己错过了永恒的美丽。

---



不知不觉当中, luz 已经到了重庆巴蜀中学门口。这是 luz 第一次来到重庆市。

比起圣菲利普斯的奢华的外观, 巴蜀中学的建筑朴素的多。

但是这所中学的学生, 却在魔法上的造诣在世界上数一数二。

拔地而起的石砖墙和宏伟庄重的教学楼似乎在讲述着学校的故事。

校门前的草坪上早已经挤满了人, 有些人喃喃自语着, 挥动着法杖, 吟诵着咒语。

这本应该是一个非常紧张的时刻, 可 luz 却没有感到丝毫不安。

一是因为甘肃省是信息学弱省, 进入省队相对来说, 并不是一件难事。二是因为 luz 从不认为参加比赛是一种挑战, 而是一场游戏, 一场属于天才的游戏。她想要的是也仅是拿到这场比赛的胜利。

luz 看了看周围, 找了片空白的草坪, 坐下闭眼休息。

刚把眼睛闭上, 旁边就传来了突兀的吵闹声。

「他们好像是西南大学附属中学的选手!」

「听说传说中的 JIangly 就在这个学校!」

「他好像去年以一名之差落选国家队」

「不就是国家队吗, 每个省不都有一个国家队的吗。若要我今年发挥得好, 我也能进国家队 」

「人家可是国家代表队, 不是那个国家集训队。再说了, 人家可是金级七阶的选手, 重庆市唯一的金级七阶选手啊」

luz 当然知道 JIangly。在 Codeforces 上面, 他目前暂居中国第一。在数次的比赛中, luz 只能拿到前一百左右的名次, 而 JIangly 却数次提前满分离场。 

「听说人家还没有男朋友, 你看我有没有机会」

「别想了, 人家会看上你? 哈哈哈哈哈哈」

luz 对偷听这种奇奇怪怪的事没有一丝兴趣。不过若是真有一位金级的选手是自己的女朋友, 这说不定是一件很幸福的事呢....

说不定我们可以一起做题, 在同一支队伍,

注视着他专注的模样。

.......

「luz, 想啥呢, 脸都红了, 哈哈哈哈哈哈哈」明亮的女声从面前传来。

「dIsangan, 都快考试了, 你还有心情开我的玩笑?」luz 愤怒的说道。

「你好不容易来我学校一次, 开开你玩笑咋了」dIsangan 笑着说「现在也应该进场了, 我带你进去吧」

luz 点了点头, 深吸了一口气, 跟随 dIsangan 进入了考场。



# 省选番外 Chapter 3

这是 luz 有史以来见过最豪华的赛场。

luz 和 dIsangan 沿着精致的暗道走进了紫水晶制作的圆形竞技场。露天的竞技场的圆心悬挂着一个分数榜, 桌椅一圈又一圈围着中间的分数榜, 构成了一个个同心圆。竞技场的最外围是观众席, 给了观战的人们一个舒适的环境。

能参加省选的都是各个学校的顶尖选手, 

luz 走到了自己的位置。安静的坐了下来。

本场比赛一共有四道题目, 满分400分。需要在四个小时内完成。四道题目分别对应着桌子上的四个灵石。选手如果完成了作答, 只需要编织星网, 然后在用自己的法杖输出答案就可以得到分数。

luz 的目标是至少完成前三道题目 - 这才能保证自己成为甘肃省队长。不像重庆市这种强省, 在甘肃省, 这场联考是唯一的考核标准。

---

大概过了半个小时。

裁判走上了分数榜下面的礼台。

「欢迎来到成都巴蜀中学」

「希望选手们可以在接下来的四个小时里, 发挥出自己的水平, 表现出自己学校的风采」

「.....」

「.....」

「我宣布! 省选正式开始!」

----

「根据先后顺序一道题一道题解决吧」

「先看看第一题」

```
T1 坐标
 - 原创题目

在二维平面上有 n 个圆, n+1 个点, 求点与点之间的最短距离, 此路径不能和其他圆相交。

对于 50% 的数据, n = 1
对于 100% 的数据, n ≤ 250
```

「计算几何....的吗?」

「那就先考虑  n = 1 的情况吧」

「在 n = 1 的情况中, 我有两个点和一个圆。」

「我需要找到这两个点的最短距离」

「首先, 如果这两点所构成的线段不与圆形相交, 那么答案就是这个线段的长度。」

「但是如果相交的话, 就不太好做了」

「我显然答案是两段直的, 一段是圆弧」

「但是我应该选择多长的一段弧呢?」

「....」

「无论如何, 我都需要先建立坐标系, 我可以选择以圆心为原点。」

「我这个时候可以把线和圆都用公式表达出来, 但是我还是没有解决圆弧应该是多长」

「但是圆弧的两个点必须在点和圆的切线所构成的圆弧上面........或者说就是那个切线的和圆的交点?」


「这个时候, 我需要选择的就是两条切线之和, 和EF这段圆弧」

「这个做法一定是正确的」

「因为DF的最短距离就是直线, 同时CE的最短距离也是直线, 然后这样走, 不可能走更少的圆弧了」

「那我们要做的就是三件事情」

「1. 求出圆和直线是否存在交点」

「2. 求出切线」

「3. 求出圆弧」

「那我就叫这个圆 $x^2+y^2 = r^2$ 吧」

「点 c 我叫做 $(x1,y1)$, 点 d 我叫做 $(x2,y2)$」

「判断两个图像的交点, 就是连立两个方程, 看有没有解」

「我叫这条线 $y = kx+b = \frac{(x-x1)}{(x2-x1)}=\frac{(y-y1)}{(y2-y1)}$」

「那么可以得到
$$
y = kx+b $$
$$
x^2+y^2= r^2 $$
$$
x^2+(kx+b)^2=r^2 $$
$$
x^2+k^2x^2+2kxb+b^2 = r^2 $$
$$
(k^2+1)x^2+(2kb)x+(b^2-r^2)=0
$$
」

「使用b^2^-4ac <0 就可以判断有没有解了」

「对于切线的话, 令其为 kx+b​ , 有」

「 
$$
y = kx+b $$ 
$$
x^2+y^2=r^2 $$ 
$$
(k^2+1)x^2+(2kb)x+(b^2-r^2)=0
$$
」

「这个东西会有一个解, 也就是b^2^ -4ac = 0, (2kb)^2^-4(k^2^+1)(b^2^-r^2^)=0 」

$$
(2kb)^2-4(k^2+1)(b^2-r^2)=0 $$ 
$$
4k^2b^2 - 4k^2b^2-4b^2+4r^2+4k^2r^2=0 $$ 
$$
-4b^2+4r^2+4k^2r^2=0 $$ 
$$
bx_1+k=y_1
$$
「带入之后, 求根就行了」

「圆弧应该怎么处理呢?」

「我的想法是我们可以算出斜率, 斜率是 y/x, 也就是 tan$\theta$」
$$
2\pi r\times (|tan^{-1}\beta-tan^{-1}\alpha|) \times360^{-1}
$$
「这就会是圆弧的答案」

「我们接下来考虑怎么求解多个圆和点」

「显然, 走的路径的点, 一定是切线和圆的交点」

「我们两两枚举圆, 计算切线」

「然后建图, 使用Floyd最短路径算法。建图的时候判断是否相交就行了。」

「这个算法的时间复杂度是 O(n^3^) 的。」

「那么, 开始吧!」

「稳扎稳打的构造出星图就行了!」

luz 说罢, 便将手上的羽毛笔停了下来, 拿起来身旁的法杖, 挥舞了起来。 

如一名舞者, 手上的法杖优雅的划出了一道道光芒。

随着光芒逐渐消散, 本毫无生机的灵石发出了浅浅的绿色。

这意味着这题通过了。

luz 紧绷的心忽然放松了许多。她环顾四周, 之后又看了下排行榜。

----



坐在她旁边的尽然是 Jiangly。从比赛开始到现在, 她的注意力集中的在解决灵石上的问题。而没有注意到自己的同桌是自己所仰慕的同学。

哪怕是这样肆无忌惮的注视着对方, 对方的眼神也是死死盯紧演算纸, 紧紧的握住了手上的羽毛笔。

好像被忽视了一样。

luz 并不了解 JIangly, 但似乎和传闻中的类似: 

红色的双马尾, 穿着代表着西南大学附属中学校的黑色外套。校徽在外套上闪闪发光。

还有坚定的眼神, 和绝对的专注力。

----



「这个速度已经十名开外....了吗? 蒋凌宇...已经到第三题了?」

「那看来我也要努力了!」

```
T2 区间线段个数
 - 原创题目

有一个自然数数轴，在数轴上一开始有 k 个线段。一个线段被表示为 |l,r|，代表的意思是指左端点在 l 右端点在 r。

选手需要维护一个数据结构，支持 m 次以下两种中其一的操作:

`add l r` 加入一条线段 |l,r|。 

`query l r` 询问数轴上 [l,r] 的范围内有多少完整线段。

对于15%的数据, k=0
对于另外30%的数据, 没有 `add` 操作
对于100%的数据, m,k≤10^6, 1≤l<r≤10^9
```

「这看起来是典型的数据结构问题」

「我需要维护一个数轴上的一些线段, 那我添加一个维度, 显然是等价于维护平面上的一些点」

「对于一个2D的平面, 我可以采取简单的归并排序解决」

「这可以解决没有 add 操作的情况」

「如果有 add 操作的话, 我扩充维度, 对操作序列的时间顺序增加一个维度」

「那此时就变成了3D空间上的矩形数点问题, 我可以考虑时间轴分治* 来解决」

「至此, 题目的得到解决」

luz 这样心想。这是她最为擅长的一类问题 - 即数据结构问题。这种题上面, 是不能轻易丢分的。

「哪怕我来自弱省, 这种数据结构问题对我来说」

「......」

「还是太简单了一些」 luz 露出了自信的微笑。「看来200分已经到手了呢」

----

*作者注: 在此故事中, 「时间轴分治」等价于「cdq分治」或「fractured cascade算法」, 至于为何不采用此名字, 作者之后会提及。

----

「.......」

「如果定义 $S_R$ 为 S 的反串」

「则考虑 i,j 连边的收益是 $b[i]_R+a[i]$, $a[j]_R+b[j]$ 这两个串中，最长的经过分界点且相等的串。对于每一个 i 求出 $b[i]_R+a[i]$ 和 $a[j]_R+b[j]$，全部串起来求 sa 和 lcp.....」

我逐渐的恢复了意识。


```
后缀数组练习题
 - 集训题目
 
幻想乡有 n 个城镇, 每个城镇有一个官方名称 A[i], 
和民间名称 B[i]. 
乡长想在幻想乡修一些地铁, 
使得城镇两两之间可以通过地铁互相抵达, 且修的地铁尽量少
在城镇 i 和 j 之间修建地铁可以得到 LCP(A[i],B[j])+LCP(A[j],B[i]) 的和谐度
求和谐度之和最大可能的值

∑A+B≤10^5  z

```



